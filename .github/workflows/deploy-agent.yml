name: Deploy Agent to Vertex AI

on:
  workflow_dispatch:  # ðŸ‘ˆ Manual trigger via GitHub UI

jobs:
  deploy-agent:
    runs-on: ubuntu-latest
    env:
      GOOGLE_PROJECT: geni-project
      REGION: asia-south1

    steps:
      - name: â¬ Checkout Code
        uses: actions/checkout@v3

      - name: ðŸ” Authenticate with Google Cloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: '${{ secrets.GCP_SA_KEY }}'

      - name: ðŸ›  Install yq
        run: |
          sudo snap install yq

      - name: ðŸ“¤ Convert YAML to JSON
        run: |
          yq -o=json '.' agent/hello_agent.yaml > agent/hello_agent.json

      - name: ðŸš€ Deploy Agent to Vertex AI
        run: |
          curl -X POST \
            -H "Authorization: Bearer $(gcloud auth print-access-token)" \
            -H "Content-Type: application/json" \
            -d @agent/hello_agent.json \
            "https://${{ env.REGION }}-aiplatform.googleapis.com/v1/projects/${{ env.GOOGLE_PROJECT }}/locations/${{ env.REGION }}/agents"